<?php


$jsonData = '[
  {
    "Title": "Communication in a business environment",
    "Learning Outcomes" : [
      {
        "Description": "Understand the requirements of written and verbal business communication",
        "Assessment Criteria": [
          {"Description": "Explain why different communication methods are used in the business environment"},
          {"Description": "Describe the communication requirements of different audiences"},
          {"Description": "Explain the importance of using correct grammar, sentence structure, punctuation, spelling and conventions in business communications"},
          {"Description": "Explain the importance of using appropriate body language and tone of voice when communicating verbally"}
        ]
      },
      { 
        "Description": "Be able to produce written business communications",
        "Assessment Criteria": [
          {"Description": "Identify the nature, purpose, audience and use of the information to be communicated"},
          {"Description": "Use communication channels that are appropriate to the information to be communicated and the audience"},
          {"Description": "Present information in the format that meets the brief"},
          {"Description": "Adhere to agreed business communication conventions and degree of formality of expression when producing documents"},
          {"Description": "Produce business communications that are clear, accurate and correct"},
          {"Description": "Meet agreed deadlines in communicating with others"}
        ]
      },
      {
       "Description": "Be able to communicate verbally in business environments",
       "Assessment Criteria": [
         {"Description": "Identify the nature, purpose, recipient/s and intended use of the information to be communicated"},
         {"Description": "Use language that is appropriate for the recipient’s needs"},
         {"Description": "Use body language and tone of voice to reinforce messages"},
         {"Description": "Identify the meaning and implications of information that is communicated verbally"},
         {"Description": "Confirm that a recipient has understood correctly what has been communicated"},
         {"Description": "Respond in a way that is appropriate to the situation and in accordance with organisational policies and standards"}
       ]
      }
    ]
  },
  {
    "Title": "Understand employer organisations",
    "Learning Outcomes" : [
      {
        "Description": "Understand organisational structures",
        "Assessment Criteria": [
          {"Description": "Explain the differences between the private sector, public sector and voluntary sector"},
          {"Description": "Explain the functions of different organisational structures"},
          {"Description": "Describe the features of different types of legal structures for organisations"}
        ]
      },
      {
        "Description": "Understand the organisational environment",
        "Assessment Criteria": [
          {"Description": "Describe the internal and external influences on organisations"},
          {"Description": "Explain the use of different models of analysis in understanding the organisational environment"},
          {"Description": "Explain why change in the business environment is important"}
        ]
      }
    ]
  },
  {
    "Title": "Principles of providing administrative services",
    "Learning Outcomes" : [
      {
        "Description": "Understand the organisation and administration of meetings",
        "Assessment Criteria": [
          {"Description": "Describe the features of different types of meetings"},
          {"Description": "Outline the different ways of providing administrative support for meetings"},
          {"Description": "Explain the steps involved in organising meetings"}
        ]
      },
      {
        "Description": "Understand the organisation of travel and accommodation",
        "Assessment Criteria": [
          {"Description": "Describe the features of different types of business travel and accommodation"},
          {"Description": "Explain the purpose of confirming instructions and requirements for business travel and accommodation"},
          {"Description": "Explain the purpose of keeping records of business travel and accommodation"}
        ]
      },
      {
        "Description": "Understand how to manage diary systems",
        "Assessment Criteria": [
          {"Description": "Describe the features of hard copy and electronic diary systems"},
          {"Description": "Explain the purpose of using diary systems to plan and co-ordinate activities and resources"},
          {"Description": "Describe the types of information needed to manage a diary system"},
          {"Description": "Explain the importance of obtaining correct information when making diary entries"}
        ]
      },
      {
        "Description": "Understand how to use office equipment",
        "Assessment Criteria": [
          {"Description": "Describe different types of office equipment"},
          {"Description": "Explain the uses of different types of office equipment"},
          {"Description": "Describe factors to be considered when selecting office equipment to complete tasks"},
          {"Description": "Describe how to keep waste to a minimum when using office equipment"}
        ]
      },
      {
        "Description": "Understand the use of mail services in a business context",
        "Assessment Criteria": [
          {"Description": "Describe the types of mail services used in business organisations"},
          {"Description": "Explain the need for different types of mail services"},
          {"Description": "Explain the factors to be considered when selecting mail services"},
          {"Description": "Explain the factors to be taken into account when choosing postage methods"}
        ]
      },
      {
        "Description": "Understand customer service in a business environment",
        "Assessment Criteria": [
          {"Description": "Describe different types of customers"},
          {"Description": "Describe the impact of their own behaviour on a customer"},
          {"Description": "Explain the impact of poor customer service"}
        ]
      }
    ]
  },
  {
    "Title": "Principles of business document production and information management",
    "Learning Outcomes" : [

      {
        "Description": "Understand how to prepare business documents",
        "Assessment Criteria": [
          {"Description": "Describe different types of business documents that may be produced and the format to be followed for each"},
          {"Description": "Explain the use of different types of information communication technology (ICT) for document production"},
          {"Description": "Explain the reasons for agreeing the use, content, layout, quality standards and deadlines for document production"},
          {"Description": "Explain the importance of document version control and authorisation"},
          {"Description": "Explain how the requirements of security, data protection, copyright and intellectual property legislation may affect the production of business documents"},
          {"Description": "Explain how to check the accuracy of business documents"}
        ]
      },
      {
        "Description": "Understand the distribution of business documents",
        "Assessment Criteria": [
          {"Description": "Explain how the requirements of security, data protection, copyright and intellectual property legislation may affect the distribution and storage of business documents"},
          {"Description": "Describe different types of distribution channels"}
        ]
      },
      {
        "Description": "Understand how information is managed in business organisations",
        "Assessment Criteria": [
          {"Description": "Describe the types of information found in business organisations"},
          {"Description": "Explain the need for safe storage and efficient retrieval of information"},
          {"Description": "Describe the features of different types of systems used for storage and retrieval of information"},
          {"Description": "Describe the legal requirements for storing business information"}
        ]
      }
    ]
  },
  {
    "Title": "Manage personal performance and development",
    "Learning Outcomes" : [
      {
        "Description": "Be able to manage personal performance",
        "Assessment Criteria": [
          {"Description": "Agree specific, measurable, achievable, realistic and time-bound (SMART) objectives that align with business needs with line manager"},
          {"Description": "Agree criteria for measuring progress and achievement with line manager"},
          {"Description": "Complete tasks to agreed timescales and quality standards"},
          {"Description": "Report problems beyond their own level of competence and authority to the appropriate person"},
          {"Description": "Take action needed to resolve any problems with personal performance"}
        ]
      },
      {
        "Description": "Be able to manage their own time and workload",
        "Assessment Criteria": [
          {"Description": "Plan and manage workloads and priorities using time management tools and techniques"},
          {"Description": "Take action to minimise distractions that are likely to limit the effective management of time and the achievement of objectives"},
          {"Description": "Explain the benefits of achieving an acceptable \'worklife balance\'"}
        ]
      },
      {
        "Description": "Be able to identify their own development needs",
        "Assessment Criteria": [
          {"Description": "Identify organisational policies relating to personal development"},
          {"Description": "Explain the need to maintain a positive attitude to feedback on performance"},
          {"Description": "Explain the potential business benefits of personal development"},
          {"Description": "Identify their own preferred learning style(s)"},
          {"Description": "Identify their own development needs from analyses of the role, personal and team objectives"},
          {"Description": "Use feedback from others to identify their own development needs"},
          {"Description": "Agree specific, measurable, achievable, realistic and time-bound (SMART) development objectives that align with organisational and personal needs"}
        ]
      },
      {
        "Description": "Be able to fulfil a personal development plan",
        "Assessment Criteria": [
          {"Description": "Agree a personal development plan that specifies actions, methods, resources, timescales and review mechanisms"},
          {"Description": "Make use of formal development opportunities that are consistent with business needs"},
          {"Description": "Use informal learning opportunities that contribute to the achievement of personal development objectives"},
          {"Description": "Review progress against agreed objectives and amend plans accordingly"},
          {"Description": "Share lessons learned with others using agreed communication methods"}        
        ]
      }
    ]
  },
  {
    "Title": "Develop working relationships with colleagues",
    "Learning Outcomes" : [
      {
        "Description": "Understand the principles of effective team working",
        "Assessment Criteria": [
          {"Description": "Outline the benefits of effective team working"},
          {"Description": "Describe how to give feedback constructively"},
          {"Description": "Explain conflict management techniques that may be used to resolve team conflicts"},
          {"Description": "Explain the importance of giving team members the opportunity to discuss work progress and any issues arising"},
          {"Description": "Explain the importance of warning colleagues of problems and changes that may affect them"}
        ]
      },
      {
        "Description": "Be able to maintain effective working relationships with colleagues",
        "Assessment Criteria": [
          {"Description": "Recognise the contribution of colleagues to the achievement of team objectives"},
          {"Description": "Treat colleagues with respect, fairness and courtesy"},
          {"Description": "Fulfil agreements made with colleagues"},
          {"Description": "Provide support and constructive feedback to colleagues"}

        ]
      },
      {
        "Description": "Be able to collaborate with colleagues to resolve problems",
        "Assessment Criteria": [
          {"Description": "Take others’ viewpoints into account when making decisions"},
          {"Description": "Take ownership of problems within own level of authority"},
          {"Description": "Take action to minimise disruption to business activities within their own level of authority"},
          {"Description": "Resolve problems within their own level of authority and agreed contribution"}
        ]
      }
    ]
  }
]';

$data = json_decode($jsonData, TRUE);
//print_r( array_keys( $data[0]['Learning Outcomes'][0]['Assessment Criteria'][0] ) );
//print_r($data);


/**
 * creates an accordion for the materialisecss framework
 *
 * @param object array $items
 * @return string (html)
 */
function createAccordion($items = []) {
  
  $htmlString = '<ul class="collapsible popout" data-collapsible="accordion">';
  foreach($items as $item) {
    $htmlString .= accordionItem($item);
  }
  return $htmlString.'</ul>';
}

/**
 * creates items that form the body of the accordion
 *
 * @param array $item object 
 * @return html (string)
 */
function accordionItem($item) {
    $htmlString = '';
    $keys = array_keys($item);

    $htmlString .= '<li>';
    $htmlString .= accordionHeader($item[$keys[0]]);
    $htmlString .= accordionBody($item[$keys[1]]);
    return $htmlString . '</li>';
  
}

/**
 * creates accordion header
 *
 * @param string $header
 * @return string (html)
 */
function accordionHeader($header) {
  return <<<EOT
  <div class="collapsible-header">$header<i class="material-icons right">add</i></div>
EOT;
}



/**
 * create the accordion body
 *
 * @param array of (learning outcomes in this case) $body or an array of assessment criteria
 * @return string (html)
 */
function accordionBody($body) {

  $htmlString = '<div class="collapsible-body">';


  if( count(array_keys($body[0])) == 2) { 
    $htmlString .= createAccordion($body);

  } else { // or we process the collection
    foreach($body as $item) {
      $htmlString .= '<ul class="collection">';
      $htmlString .= collectionItem($item); 
      $htmlString .= '</ul>';
    }    
  }   
  return $htmlString;
}

/**
 * creates an item that forms the body of the collection
 *
 * @param string $item
 * @return string (html)
 */
function collectionItem($item) {
  $keys = array_keys($item);
  $key = $keys[0];
  return <<<EOT
  <li class="collection-item"> $item[$key] <i class="material-icons right">add</i></li>
EOT;
}




/**
 * render the page
 *
 * @param [assoc. array created from json] $data 
 * @return void
 */
function render($data) {
  echo createAccordion($data);
}

?>

        <span>4 Units</span> - <span>17 Learning Outcomes</span> - <span>61 Assessment Criteria</span>
        <div class="input-field clearfix">
          <input placeholder="Type to filter" id="filter" type="text" style="width: 90%">
        </div>

        <?php render($data); ?>